---
import { getCollection } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
import { SITE_TITLE } from '../consts';
import { getReadingTimeFromEntry, formatReadingTime } from '../utils/reading-time';

// Redirect to home in production
const isDev = import.meta.env.DEV;
if (!isDev) {
	return Astro.redirect('/');
}

// Get only draft posts
const allPosts = await getCollection('blog');
const drafts = allPosts
	.filter(post => post.data.draft)
	.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

function formatDate(date: Date) {
	return date.toLocaleDateString('en-US', {
		year: 'numeric',
		month: 'short',
		day: 'numeric'
	});
}
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={`Draft Posts | ${SITE_TITLE}`} description="Unpublished draft posts - development only" />
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=IBM+Plex+Sans:wght@400;500;600&display=swap" rel="stylesheet">
	</head>
	<body>
		<Header />
		<main>
			<div class="container">
				<!-- Page Header -->
				<header class="page-header">
					<div class="draft-indicator">
						<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
							<line x1="12" y1="9" x2="12" y2="13"></line>
							<line x1="12" y1="17" x2="12.01" y2="17"></line>
						</svg>
						<span>Development Only</span>
					</div>
					<h1>Draft Posts</h1>
					<p class="subtitle">
						Unpublished posts that are only visible in development mode.
						These will not appear in production builds.
					</p>
					<a href="/blog" class="back-link">
						<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<path d="M19 12H5M12 19l-7-7 7-7"/>
						</svg>
						Back to all posts
					</a>
				</header>

				<!-- Draft Posts List -->
				{drafts.length > 0 ? (
					<section class="drafts-section">
						<div class="drafts-count">
							{drafts.length} draft {drafts.length === 1 ? 'post' : 'posts'}
						</div>
						<div class="drafts-list">
							{drafts.map((post, index) => (
								<a href={`/blog/${post.id}/`} class="draft-item">
									<span class="draft-number">{String(index + 1).padStart(2, '0')}</span>
									<div class="draft-content">
										<h3>{post.data.title}</h3>
										<p>{post.data.description}</p>
										<div class="draft-meta">
											<time datetime={post.data.pubDate.toISOString()}>
												{formatDate(post.data.pubDate)}
											</time>
											<span class="meta-separator">•</span>
											<span class="reading-time">{formatReadingTime(getReadingTimeFromEntry(post))}</span>
											{post.data.series && (
												<>
													<span class="meta-separator">•</span>
													<span class="series-badge">
														{post.data.series} ({post.data.seriesPart}/{post.data.seriesTotal})
													</span>
												</>
											)}
										</div>
									</div>
									<span class="draft-arrow">
										<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
											<path d="M5 12h14M12 5l7 7-7 7"/>
										</svg>
									</span>
								</a>
							))}
						</div>
					</section>
				) : (
					<div class="empty-state">
						<svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
							<path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
						</svg>
						<p class="empty-message">No draft posts found</p>
						<p class="empty-hint">Create a new blog post with <code>draft: true</code> in the frontmatter</p>
					</div>
				)}
			</div>
		</main>
		<Footer />
	</body>
</html>

<style>
	:root {
		--font-display: 'DM Serif Display', Georgia, serif;
		--font-body: 'IBM Plex Sans', system-ui, sans-serif;
		--color-bg: #0a0a0b;
		--color-bg-elevated: #111113;
		--color-bg-hover: #18181b;
		--color-border: #27272a;
		--color-border-subtle: #1f1f23;
		--color-text-primary: #fafafa;
		--color-text-secondary: #a1a1aa;
		--color-text-muted: #71717a;
		--color-accent: #3b82f6;
		--color-warning: #f59e0b;
	}

	body {
		background-color: var(--color-bg);
		color: var(--color-text-primary);
		font-family: var(--font-body);
		margin: 0;
		line-height: 1.6;
	}

	main {
		min-height: calc(100vh - 200px);
	}

	.container {
		max-width: 800px;
		margin: 0 auto;
		padding: 0 1.5rem 4rem;
	}

	/* Page Header */
	.page-header {
		padding: 4rem 0 3rem;
		border-bottom: 1px solid var(--color-border-subtle);
		margin-bottom: 3rem;
	}

	.draft-indicator {
		display: inline-flex;
		align-items: center;
		gap: 0.5rem;
		font-size: 0.75rem;
		font-weight: 600;
		text-transform: uppercase;
		letter-spacing: 0.1em;
		color: var(--color-warning);
		background: rgba(245, 158, 11, 0.1);
		padding: 0.5rem 1rem;
		border-radius: 100px;
		border: 1px solid rgba(245, 158, 11, 0.3);
		margin-bottom: 1.5rem;
	}

	.draft-indicator svg {
		flex-shrink: 0;
	}

	.page-header h1 {
		font-family: var(--font-display);
		font-size: clamp(2.5rem, 5vw, 3.5rem);
		font-weight: 400;
		margin: 0 0 1rem;
		line-height: 1.1;
		letter-spacing: -0.02em;
	}

	.subtitle {
		font-size: 1.125rem;
		color: var(--color-text-secondary);
		margin: 0 0 1.5rem;
		max-width: 500px;
		line-height: 1.7;
	}

	.back-link {
		display: inline-flex;
		align-items: center;
		gap: 0.5rem;
		font-size: 0.875rem;
		color: var(--color-accent);
		text-decoration: none;
		transition: gap 0.2s ease;
	}

	.back-link:hover {
		gap: 0.75rem;
	}

	/* Drafts Section */
	.drafts-section {
		margin-top: 2rem;
	}

	.drafts-count {
		font-size: 0.75rem;
		font-weight: 600;
		text-transform: uppercase;
		letter-spacing: 0.1em;
		color: var(--color-text-muted);
		margin: 0 0 1.5rem;
		padding-bottom: 1rem;
		border-bottom: 1px solid var(--color-border-subtle);
	}

	.drafts-list {
		display: flex;
		flex-direction: column;
		gap: 0;
	}

	.draft-item {
		display: grid;
		grid-template-columns: auto 1fr auto;
		align-items: center;
		gap: 1.5rem;
		padding: 1.5rem 0;
		border-bottom: 1px solid var(--color-border-subtle);
		text-decoration: none;
		transition: all 0.2s ease;
	}

	.draft-item:hover {
		padding-left: 1rem;
		padding-right: 1rem;
		margin-left: -1rem;
		margin-right: -1rem;
		background: var(--color-bg-hover);
		border-radius: 12px;
		border-bottom-color: transparent;
	}

	.draft-item:hover + .draft-item {
		border-top-color: transparent;
	}

	.draft-item:hover .draft-arrow {
		opacity: 1;
		transform: translateX(0);
	}

	.draft-item:hover h3 {
		color: var(--color-accent);
	}

	.draft-number {
		font-family: 'SF Mono', 'Fira Code', monospace;
		font-size: 0.8125rem;
		color: var(--color-warning);
		min-width: 1.5rem;
		font-weight: 600;
	}

	.draft-content {
		min-width: 0;
	}

	.draft-content h3 {
		font-family: var(--font-body);
		font-size: 1.0625rem;
		font-weight: 500;
		margin: 0 0 0.25rem;
		color: var(--color-text-primary);
		transition: color 0.2s ease;
	}

	.draft-content p {
		font-size: 0.875rem;
		color: var(--color-text-muted);
		margin: 0 0 0.375rem;
		white-space: nowrap;
		overflow: hidden;
		text-overflow: ellipsis;
	}

	.draft-meta {
		display: flex;
		align-items: center;
		gap: 0.5rem;
		font-size: 0.8125rem;
		color: var(--color-text-muted);
		flex-wrap: wrap;
	}

	.meta-separator {
		opacity: 0.5;
	}

	.series-badge {
		background: rgba(59, 130, 246, 0.1);
		color: var(--color-accent);
		padding: 0.125rem 0.5rem;
		border-radius: 4px;
		font-size: 0.75rem;
		font-weight: 500;
	}

	.draft-arrow {
		display: flex;
		align-items: center;
		justify-content: center;
		width: 32px;
		height: 32px;
		color: var(--color-accent);
		opacity: 0;
		transform: translateX(-8px);
		transition: all 0.2s ease;
	}

	/* Empty State */
	.empty-state {
		text-align: center;
		padding: 4rem 2rem;
		color: var(--color-text-muted);
	}

	.empty-state svg {
		margin-bottom: 1.5rem;
		opacity: 0.5;
	}

	.empty-message {
		font-size: 1.25rem;
		color: var(--color-text-secondary);
		margin: 0 0 0.5rem;
	}

	.empty-hint {
		font-size: 0.875rem;
		margin: 0;
	}

	.empty-hint code {
		background: var(--color-bg-elevated);
		padding: 0.25rem 0.5rem;
		border-radius: 4px;
		font-family: 'SF Mono', monospace;
		font-size: 0.8125rem;
		color: var(--color-accent);
	}

	/* Responsive */
	@media (max-width: 640px) {
		.page-header {
			padding: 3rem 0 2rem;
		}

		.draft-item {
			grid-template-columns: auto 1fr;
			gap: 1rem;
		}

		.draft-arrow {
			display: none;
		}

		.draft-content p {
			display: none;
		}
	}

	/* Animation */
	@keyframes fadeSlideIn {
		from {
			opacity: 0;
			transform: translateY(12px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	.page-header {
		animation: fadeSlideIn 0.5s ease forwards;
	}

	.drafts-section {
		animation: fadeSlideIn 0.5s ease 0.1s forwards;
		opacity: 0;
	}
</style>
